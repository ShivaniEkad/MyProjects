
$(function(){var g={primaryStyles:"fontFamily fontSize fontWeight fontVariant fontStyle paddingLeft paddingTop paddingBottom paddingRight marginLeft marginTop marginBottom marginRight borderLeftColor borderTopColor borderBottomColor borderRightColor borderLeftStyle borderTopStyle borderBottomStyle borderRightStyle borderLeftWidth borderTopWidth borderBottomWidth borderRightWidth line-height outline text-align".split(" "),specificStyle:{"word-wrap":"break-word","overflow-x":"hidden","overflow-y":"auto"},
simulator:$('<div id="textarea_simulator"/>').css({position:"absolute",top:0,left:0,visibility:"hidden"}).appendTo(document.body),toHtml:function(b){return b.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").split(" ").join('<span style="white-space:prev-wrap">&nbsp;</span>')},getCaretPosition:function(){var b=g,c=this,a=c[0],d=c.offset();if($.browser.msie&&9>=$.browser.version){a.focus();var e=document.selection.createRange();$("#hskeywords").val(a.scrollTop);return{left:e.boundingLeft-
d.left,top:parseInt(e.boundingTop)-d.top+a.scrollTop+document.documentElement.scrollTop+parseInt(c.getComputedStyle("fontSize"))}}b.simulator.empty();$.each(b.primaryStyles,function(a,d){c.cloneStyle(b.simulator,d)});b.simulator.css($.extend({width:c.width(),height:c.height()},b.specificStyle));var e=c.val()||c.text(),f=c.getCursorPosition(),d=e.substring(0,f),e=e.substring(f),f=$('<span class="before"/>').html(b.toHtml(d)),d=$('<span class="focus"/>'),e=$('<span class="after"/>').html(b.toHtml(e));
b.simulator.append(f).append(d).append(e);e=d.offset();f=b.simulator.offset();return{top:e.top-f.top-a.scrollTop+($.browser.mozilla?0:parseInt(c.getComputedStyle("fontSize"))),left:d[0].offsetLeft-b.simulator[0].offsetLeft-a.scrollLeft}}};$.fn.extend({setCursorPosition:function(b){return 0==this.length?this:$(this).setSelection(b,b)},setSelection:function(b,c){if(0==this.length)return this;input=this[0];if(input.createTextRange){var a=input.createTextRange();a.collapse(!0);a.moveEnd("character",c);
a.moveStart("character",b);a.select()}else if(input.setSelectionRange)input.focus(),input.setSelectionRange(b,c);else{var d=this.get(0),a=document.createRange();a.collapse(!0);a.setStart(d.childNodes[0],b);a.setEnd(d.childNodes[0],c);d=window.getSelection();d.removeAllRanges();d.addRange(a)}return this},getComputedStyle:function(b){if(0!=this.length){var c=this[0],a=this.css(b);return a=a||($.browser.msie?c.currentStyle[b]:document.defaultView.getComputedStyle(c,null)[b])}},cloneStyle:function(b,
c){var a=this.getComputedStyle(c);a&&$(b).css(c,a)},cloneAllStyle:function(b,c){var a=this[0],d;for(d in a.style){var e=a.style[d];"string"==typeof e||"number"==typeof e?this.cloneStyle(b,d):NaN}},getCursorPosition:function(){var b=input=this[0],c=input.value||input.innerText;this.data("lastCursorPosition")||this.data("lastCursorPosition",0);var a=this.data("lastCursorPosition");if(document.selection)input.focus(),b=document.selection.createRange(),a=document.selection.createRange().text.length,b.moveStart("character",
-c.length),a=b.text.length-a;else{if(input.selectionStart||"0"==input.selectionStart)return input.selectionStart;if("undefined"!=typeof window.getSelection&&0<window.getSelection().rangeCount)try{var d=window.getSelection().getRangeAt(0),e=d.cloneRange();e.selectNodeContents(b);e.setEnd(d.endContainer,d.endOffset);a=e.toString().length}catch(f){a=this.data("lastCursorPosition")}else"undefined"!=typeof document.selection&&"Control"!=document.selection.type&&(c=document.selection.createRange(),a=document.body.createTextRange(),
a.moveToElementText(b),a.setEndPoint("EndToEnd",c),a=a.text.length)}this.data("lastCursorPosition",a);return a},getCaretPosition:g.getCaretPosition})});;
!function(a,b,c){function g(b,c){this.element=b,this.$element=a(b),this.$itemList=a(g.MENU_TEMPLATE),this.options=a.extend({},f,c),this.reset(),this._defaults=f,this._name=e,this.expression=new RegExp("(^|\\b|\\s)"+this.options.token+"([\\w.]*)$"),this.cleanupHandle=null,this.init()}var d=function(a,b){a.text(b.val)},e="sew",f={token:"#",elementFactory:d,values:[],unique:!1,repeat:!0};g.MENU_TEMPLATE="<div class='-sew-list-container' style='display: none; position: absolute;'><ul class='-sew-list'></ul></div>",g.ITEM_TEMPLATE='<li class="-sew-list-item"></li>',g.KEYS=[40,38,13,27,9],g.prototype.init=function(){this.options.values.length<1||this.$element.bind("keyup",a.proxy(this.onKeyUp,this)).bind("keydown",a.proxy(this.onKeyDown,this)).bind("focus",a.proxy(this.renderElements,this,this.options.values)).bind("blur",a.proxy(this.remove,this))},g.prototype.reset=function(){this.options.unique&&(this.options.values=g.getUniqueElements(this.options.values)),this.index=0,this.matched=!1,this.dontFilter=!1,this.lastFilter=c,this.filtered=this.options.values.slice(0)},g.prototype.next=function(){this.index=(this.index+1)%this.filtered.length,this.hightlightItem()},g.prototype.prev=function(){this.index=(this.index+this.filtered.length-1)%this.filtered.length,this.hightlightItem()},g.prototype.select=function(){this.replace(this.filtered[this.index].val),this.$element.trigger("mention-selected",this.filtered[this.index]),this.hideList()},g.prototype.remove=function(){this.$itemList.fadeOut("slow"),this.cleanupHandle=b.setTimeout(a.proxy(function(){this.$itemList.remove()},this),1e3)},g.prototype.replace=function(a){var b=this.$element.getCursorPosition(),c=this.getText(),d=c.substring(0,b);d=d.replace(this.expression,"$1"+this.options.token+a);var e=c.substring(b,c.length),f=e.match(/^\s/)?"":" ",g=d+f+e;this.setText(g),this.$element.setCursorPosition(d.length+1)},g.prototype.hightlightItem=function(){this.$itemList.find(".-sew-list-item").removeClass("selected");var a=this.$itemList.find(".-sew-list-item").parent(),b=this.filtered[this.index].element.addClass("selected"),c=b.position().top;a.scrollTop(a.scrollTop()+c)},g.prototype.renderElements=function(b){a("body").append(this.$itemList);var c=this.$itemList.find("ul").empty();b.forEach(a.proxy(function(b,d){var e=a(g.ITEM_TEMPLATE);this.options.elementFactory(e,b),b.element=e.appendTo(c).bind("click",a.proxy(this.onItemClick,this,b)).bind("mouseover",a.proxy(this.onItemHover,this,d))},this)),this.index=0,this.hightlightItem()},g.prototype.displayList=function(){if(this.filtered.length){this.$itemList.show();var a=this.$element,b=this.$element.offset(),c=a.getCaretPosition();this.$itemList.css({left:b.left+c.left,top:b.top+c.top})}},g.prototype.hideList=function(){this.$itemList.hide(),this.reset()},g.prototype.filterList=function(b){if(b!=this.lastFilter){this.lastFilter=b,this.$itemList.find(".-sew-list-item").remove();var c=this.options.values,d=this.filtered=c.filter(a.proxy(function(a){var c=new RegExp("\\W*"+this.options.token+a.val+"(\\W|$)");return!this.options.repeat&&this.getText().match(c)?!1:""===b||a.val.toLowerCase().indexOf(b.toLowerCase())>=0||(a.meta||"").toLowerCase().indexOf(b.toLowerCase())>=0},this));d.length?(this.renderElements(d),this.$itemList.show()):this.hideList()}},g.getUniqueElements=function(a){var b=[];return a.forEach(function(a){var c=b.map(function(a){return a.val}).indexOf(a.val)>=0;c||b.push(a)}),b},g.prototype.getText=function(){return this.$element.val()||this.$element.text()},g.prototype.setText=function(a){this.$element.is("input,textarea")?this.$element.val(a):this.$element.html(a)},g.prototype.onKeyUp=function(){var b=this.$element.getCursorPosition(),c=this.getText().substring(0,b),d=c.match(this.expression);return!d&&this.matched?(this.matched=!1,this.dontFilter=!1,this.hideList(),void 0):(d&&!this.matched&&(this.displayList(),this.lastFilter="\n",this.matched=!0),d&&!this.dontFilter&&this.filterList(d[2]),void 0)},g.prototype.onKeyDown=function(a){var b=this.$itemList.is(":visible");if(b&&!(g.KEYS.indexOf(a.keyCode)<0)){switch(a.keyCode){case 9:case 13:this.select();break;case 40:this.next();break;case 38:this.prev();break;case 27:this.$itemList.hide(),this.dontFilter=!0}a.preventDefault()}},g.prototype.onItemClick=function(a){this.cleanupHandle&&b.clearTimeout(this.cleanupHandle),this.replace(a.val),this.$element.trigger("mention-selected",this.filtered[this.index]),this.hideList()},g.prototype.onItemHover=function(a){this.index=a,this.hightlightItem()},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})}}(jQuery,window);
;
Project.modules.pushnotify={init:function(){this.initEvents();this.validate()},validate:function(){$("#frmpushnotifyadd").validate({rules:{vSendTo:{required:!0}},messages:{vSendTo:{required:js_lang_label.GENERIC_PLEASE_SELECT_USERS}},errorPlacement:function(b,a){"vSendTo"==a.attr("name")&&b.appendTo("#vSendToErr")}})},initEvents:function(){$("#vSendTo").on("change",function(){var b=$("#vSendTo").val();$.post(admin_url+$pushnotify_module_fields,{sent_id:b},function(a){$("#div_module_other").html(a);
$("#div_module_other").show();initializejQueryChosenEvents();$(".elastic").elastic();initializeTooltipsEvents()});$.post(admin_url+$pushnotify_select_fields,{device_id:b},function(a){$('select[id^="push_notify_value_"]').each(function(b){$(this).html(a).trigger("chosen:updated");changeParameters($(this).get(0));if(0==b){var c=[];$(this).find("option").each(function(){"Other"!=$(this).val()&&c.push({val:$(this).val()+"#"})});setMessageSuggestions(c)}})})});$(".elastic").elastic()},getValidatePushNotify:function(){var b=
{beforeSubmit:showAdminAjaxRequest,success:function(a,b,c,d){a=$.parseJSON(a);responseAjaxDataSubmission(a);if("0"==a.success)return!1}};$("#frmpushnotifyadd").ajaxSubmit(b);return!1},getVariableDescriptionTable:function(){var b=admin_url+$push_notify_variables,a=$("#vSendTo").val();$.post(b,{device_id:a,row_id:inc_no,dis_no:dis_no},function(a){$("#mails_fields_list").append(a);initializeTooltipsEvents();initializejQueryChosenEvents();inc_no++;dis_no++})},deletePushnotifyVariableRow:function(b){jqueryUIdialogBox("<div></div>",
js_lang_label.GENERIC_ARE_YOU_SURE_TO_DELETE_THIS_VARIABLE,{title:js_lang_label.GENERIC_DELETE_VARIABLE,buttons:[{text:js_lang_label.GENERIC_OK,bt_type:"ok",click:function(){$("#tr_child_row_"+b).remove();var a=1;dis_no--;$(".row-num-child").each(function(){$(this).html(a);a++});$(this).remove()}},{text:js_lang_label.GENERIC_CANCEL,bt_type:"cancel",click:function(){$(this).remove()}}]})}};Project.modules.pushnotify.init();
function changeParameters(b){var a=b.id;"Other"==b.value?$("#"+a+"_Other").show():$("#"+a+"_Other").hide()}function setMessageSuggestions(b){$("#vMessage").data("plugin_sew")?$("#vMessage").data("plugin_sew").options.values=b:$("#vMessage").sew({values:b,elementFactory:function(a,b){var c=$("<div><span />&nbsp;<small /></div>").find("span").text("#"+b.val).end().find("small").end();a.append(c)}})};;